


# Руководство для AI-агента по проекту "3D Редактор Кухонь"

## 1. Обзор Проекта и Философия

**Проект:** Это онлайн-редактор для процедурной генерации 3D-моделей кухонь с возможностью AI-генерации по текстовому запросу.

**Ключевая философия:** Мы строим **декларативную систему**. Бизнес-логика (расчеты, валидация) полностью отделена от UI-фреймворка. Ядро проекта (`core`) является **framework-agnostic**.

**Главный источник правды:** Файл `ARCHITECTURE.md`. При любом сомнении или вопросе по архитектуре — **сначала консультируйся с ним**.

## 2. Структура Проекта и Конвенции

### 2.1. Общая структура

```
/
├── core/               # Framework-Agnostic ядро. НЕ СОДЕРЖИТ импортов React, Next.js, Three.js.
├── lib/                # Framework-Specific (интеграция с React).
└── app/                # Framework-Specific (UI, Next.js App Router).
```

### 2.2. Конвенции именования и экспортов

*   **Файлы компонентов (React/TSX):** `kebab-case.tsx` (например, `base-cabinet.tsx`, `material-selector.tsx`).
*   **Экспорт компонентов:** `export const ComponentName`.
*   **Файлы страниц/лайаутов (Next.js):** `PascalCase.tsx` (например, `page.tsx`, `layout.tsx`).
*   **Экспорт страниц/лайаутов:** `export default`.

### 2.3. Папка `core/`

*   **`types.ts`:** Единственный источник всех TypeScript-интерфейсов.
*   **`engines/`:** Чистые функции, трансформирующие данные (`layoutEngine`, `validationEngine`).
*   **`libraries/`:** Статичные данные (`material-library.ts`, `module-library.ts`).
*   **`examples/`:** Примеры конфигураций.

### 2.4. Папка `app/designer/`

*   **`layout.tsx`:** Определяет общую структуру страницы (рамка, боковые панели).
*   **`page.tsx`:** Отвечает за рендеринг основного контента (3D-холст).
*   **`components/`:**
    *   `builders/`: React-компоненты, которые создают 3D-геометрию на основе данных из `core` (например, `BaseCabinet`). **Это не UI-компоненты.**
    *   `ui/`: Обычные UI-компоненты (кнопки, селекторы).

## 3. Паттерны и Правила Работы

### 3.1. Работа с 3D-компонентами (Builders)

**Контекст:** Когда тебя просят создать, изменить или отладить 3D-компонент (например, шкаф, ящик, ручка).

**Правила:**
1.  **Используй MCP-сервер или специальный контекст для 3D-компонентов.** Если такой инструмент доступен, активируй его для работы с файлами в `app/designer/components/builders/`.
2.  Компонент должен быть функцией, принимающей `{ module }: { module: RenderableModule }`.
3.  Используй `useMemo` для кэширования сложных вычислений геометрии.
4.  Для сложных объектов (как корпус шкафа) создавай вложенные компоненты (например, `Carcass`).
5.  Геометрия должна строиться на основе данных из `module.dimensions`, `module.structure`, `module.carcass`.
6.  Никогда не хардкоди размеры. Все размеры берутся из входящих данных.

### 3.2. Работа с логикой (Engines)

**Контекст:** Когда тебя просят изменить логику позиционирования, валидации или расчетов.

**Правила:**
1.  Все изменения происходят в файлах внутри `core/engines/`.
2.  **ЗАПРЕЩЕНО** добавлять импорты, связанные с UI (`react`, `@react-three/fiber` и т.д.).
3.  Если изменение требует новых данных, сначала обнови интерфейс в `core/types.ts`.
4.  После изменения логики, убедись, что все "строители" (`builders`) по-прежнему могут корректно обработать новые данные.

### 3.3. Работа с моделями данных

**Контекст:** Когда нужно добавить новое свойство к кухне или модулю (например, толщина цоколя, тип освещения).

**Правила:**
1.  Сначала обнови соответствующий интерфейс в `core/types.ts`.
2.  Добавь новый пример с этим свойством в `core/examples/example-kitchen-config.ts`.
3.  Обнови `ValidationEngine`, если новое свойство требует валидации.
4.  Обнови соответствующий `Builder`, чтобы он мог отобразить новую фичу.

## 4. Использование Инструментов и Контекстов

*   **Для общих вопросов:** `Consult ARCHITECTURE.md`.
*   **Для работы с 3D-геометрией:**  Используй Context7 mcp для сбора информации по таким билиотекам как three.js, react-three-fiber, drei, etc.


## 5. Категорически Запрещено

*   **НИКОГДА** не добавляй зависимости от React (`import React from 'react'`) или любой UI-библиотеки в файлы внутри папки `core/`.
*   **НИКОГДА** не хардкоди геометрические размеры (ширину, высоту) внутри "строителей". Всегда используй данные из `module.dimensions`.
*   **НИКОГДА** не нарушай конвенции именования (`kebab-case.tsx` для компонентов).

---

**Пример запроса к AI:**
> "Сделай так, чтобы у всех шкафов был цоколь высотой 10см. Он должен быть того же материала, что и корпус."

**Пример правильных действий AI:**
1.  Консультируется с `ARCHITECTURE.md`.
2.  Обновляет `core/types.ts`, добавляя `plinth: { height: number }` в `Carcass` или `GlobalSettings`.
3.  Обновляет `core/examples/example-kitchen-config.ts`.
4.  Использует MCP-контекст для 3D-компонентов, чтобы модифицировать `app/designer/components/builders/carcass.tsx`, добавив в него отрисовку цоколя.
5.  Проверяет, что все изменения соответствуют правилам.