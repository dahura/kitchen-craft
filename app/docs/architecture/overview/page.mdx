---
title: Архитектура 3D Редактора Кухонь
---

# Архитектура 3D Редактора Кухонь (TypeScript)

## 1. Обзор и Философия

Мы строим **декларативную систему** для procedural-генерации кухонь. UI/ИИ создает JSON-описание, а фреймворк-agnostic ядро `core` превращает его в 3D-сцену.

## 2. Ключевые Компоненты

*   **UI (Next.js):** Слой представления и управления состоянием.
*   **AI Agent:** Генерирует JSON-конфигурацию по текстовому запросу.
*   **Core / Validation Engine:** Проверяет и исправляет JSON.
*   **Core / Layout Engine:** **(Ядро)**. Рассчитывает 3D-координаты и создает иерархию объектов.
*   **Geometry Generator:** Создает 3D-меш.
*   **3D Renderer:** Отображает сцену (Three.js).

## 3. Структура Проекта

Вся бизнес-логика инкапсулирована в `core`.
```
/core
├── types.ts                    # Все интерфейсы TypeScript
├── engines/
│   ├── layoutEngine/           # Расчет координат
│   └── validationEngine/       # Валидация и исправление
├── libraries/
│   ├── materialLibrary/        # Материалы и ассеты
│   └── moduleLibrary/          # Справочник модулей
└── examples/                   # Примеры конфигураций
    ├── example-kitchen-config.ts 
```

## 4. Поток Данных (Data Flow)

1.  **UI/ИИ** создает `KitchenConfig`.
2.  **Validation Engine** проверяет и чинит конфиг.
3.  **Layout Engine** принимает "починенный" конфиг и `materialLibrary`.
4.  **Layout Engine** возвращает массив `RenderableModule[]` с готовыми координатами.
5.  Массив передается в **Geometry Generator** и **3D Renderer**.

## 5. Ключевые Архитектурные Решения

*   **`layoutLines`:** Явное описание стен для последовательного размещения модулей.
*   **Позиционирование по правилам:** Модули размещаются через `anchor`, `offset`, `alignWithModule`, а не жесткие координаты.
*   **Материалы через ключи:** ИИ отдает только ключи (`"scandinavian_oak"`), полные данные хранятся в `material-library.ts`.
*   **Иерархия (`children`):** Фурнитура (ручки) является дочерним элементом модуля.
*   **Валидация:** `ValidationEngine` защищает систему от некорректных данных (`auto_fix`, `warn`, `error`).

## 6. Дорожная Карта

- [x] Проектирование архитектуры
- [x] Layout Engine (TS, функциональный)
- [x] Система материалов и фурнитуры
- [x] Validation Engine (TS)
- [x] Организация кода в ядро `core`
- [ ] **Проектирование UI и логики взаимодействия**
- [ ] Разработка Geometry Generator